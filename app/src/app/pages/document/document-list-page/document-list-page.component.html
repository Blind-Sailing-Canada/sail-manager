<mat-card>
  <mat-card-header>
    <div mat-card-avatar>
      <mat-icon>local_library</mat-icon>
    </div>
    <mat-card-title
      id="pageTitle"
      tabindex="0"
      role="heading"
    >Documents</mat-card-title>
    <mat-card-subtitle *ngIf="entity">
      {{subheading}}
    </mat-card-subtitle>
  </mat-card-header>
  <mat-card-actions *ngTemplateOutlet="CONTROLS_TEMPLATE"></mat-card-actions>
  <mat-card-content>
    <ng-container [ngTemplateOutlet]="documentTable"></ng-container>
  </mat-card-content>
</mat-card>

<ng-template #CONTROLS_TEMPLATE>
  <button
    *ngIf="shouldEnableNewButton"
    (click)="goToNewDocument()"
    title="Go to new document page"
    mat-raised-button
  >New</button>
</ng-template>

<ng-template #documentTable>
  <div class="mat-elevation-z2">
    <div class="table-filters">
      <mat-form-field>
        <mat-label>Search</mat-label>
        <input
          matInput
          #filterInput
        >
      </mat-form-field>
    </div>
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      (matSortChange)="sortHandler($event)"
      matSortActive="created_at"
      matSortDirection="desc"
    >
      <ng-container matColumnDef="title">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > Title </th>
        <td
          mat-cell
          *matCellDef="let element"
        > <a
            mat-button
            (click)="viewDocument(element.id)"
            aria-details="Click to go to document details page."
          >{{element.title}}</a> </td>
      </ng-container>

      <ng-container matColumnDef="documentable_type">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > Entity </th>
        <td
          mat-cell
          *matCellDef="let element"
        > <a
            mat-button
            (click)="goToEntity(element.documentable_type, element.documentable_id)"
          >{{getEntityLabel(element.documentable_type)}} </a></td>
      </ng-container>

      <ng-container matColumnDef="created_at">
        <th
          mat-header-cell
          *matHeaderCellDef
          [disabled]="loading"
          mat-sort-header
        > Created </th>
        <td
          mat-cell
          *matCellDef="let element"
        > {{element.created_at | humanDateWithTime}} </td>
      </ng-container>

      <ng-container matColumnDef="end_at">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > End </th>
        <td
          mat-cell
          *matCellDef="let element"
        > {{element.end_at | humanDateWithTime}} </td>
      </ng-container>

      <ng-container matColumnDef="download">
        <th
          mat-header-cell
          *matHeaderCellDef
        ></th>
        <td
          mat-cell
          *matCellDef="let element"
        > <a
            [href]="element.fileLocation"
            target="_blank"
            mat-button
          >Download</a></td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns"
      ></tr>
      <tr
        *matRowDef="let row; columns: displayedColumns;"
        mat-row
      ></tr>
    </table>

    <mat-paginator
      (page)="paginationHandler($event)"
      [disabled]="loading"
      [length]="paginatedData?.total || 0"
      [pageSizeOptions]="[1, 10, 20, 50]"
      [pageSize]="20"
      [showFirstLastButtons]="paginatedData?.total > paginatedData?.count"
      aria-label="Select page of documents"
    >
    </mat-paginator>
  </div>
</ng-template>

<mat-card>
  <mat-card-header>
    <div mat-card-avatar>
      <mat-icon>build</mat-icon>
    </div>
    <mat-card-title
      *ngIf="!boat_id"
      id="pageTitle"
      role="heading"
      tabindex="0"
    >
      Maintenance
    </mat-card-title>
    <mat-card-title
      *ngIf="boat_id"
      id="pageTitle"
      role="heading"
      tabindex="0"
    >
      Maintenance for {{boatName}}
    </mat-card-title>
  </mat-card-header>
  <mat-card-actions>
    <ng-container [ngTemplateOutlet]="controls"></ng-container>
  </mat-card-actions>
  <mat-card-content>
    <ng-container
      [ngTemplateOutlet]="MAINTENANCE_TABLE"
      *ngIf="!windowService.isSmallWidth"
    ></ng-container>
    <ng-container
      [ngTemplateOutlet]="MAINTENANCE_TABLE_MOBILE"
      *ngIf="windowService.isSmallWidth"
    ></ng-container>
  </mat-card-content>
</mat-card>

<ng-template #controls>
  <a
    (click)="goToCreateNewMaintenance()"
    mat-raised-button
    title="Go to create new maintenance request"
  >New</a>
  <button
    (click)="filterMaintenances()"
    mat-raised-button
    title="Refresh new maintenance requests list"
  >Refresh</button>
</ng-template>

<ng-template #MAINTENANCE_TABLE>
  <div class="mat-elevation-z2">
    <div class="table-filters">
      <mat-form-field>
        <mat-label>Search</mat-label>
        <input
          matInput
          #filterInput
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Status</mat-label>
        <select
          [(ngModel)]="maintenanceStatus"
          [ngModelOptions]="{standalone: true}"
          matNativeControl
          (ngModelChange)="filterMaintenances()"
        >
          <option
            *ngFor="let status of maintenanceStatusValues | keyvalue"
            [value]="status.value"
          >{{status.key}}</option>
        </select>
      </mat-form-field>
    </div>
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      (matSortChange)="sortHandler($event)"
      matSortActive="created_at"
      matSortDirection="desc"
    >
      <ng-container matColumnDef="request_details">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > Request </th>
        <td
          mat-cell
          *matCellDef="let element"
        > {{element.request_details}} </td>
      </ng-container>
      <ng-container matColumnDef="boat">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > Boat </th>
        <td
          mat-cell
          *matCellDef="let element"
        > <button
            mat-button
            (click)="showBoatDialog(element.boat)"
          >{{element.boat?.name}}</button> </td>
      </ng-container>
      <ng-container matColumnDef="created_at">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > Created at </th>
        <td
          mat-cell
          *matCellDef="let element"
        > {{element.created_at | humanDate}} </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > Status </th>
        <td
          mat-cell
          *matCellDef="let element"
        > {{element.status}} </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > </th>
        <td
          mat-cell
          *matCellDef="let element"
        > <a
            mat-button
            (click)="goToViewMaintenance(element)"
            title="Click to view this request"
          >View</a> </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns"
      ></tr>
      <tr
        *matRowDef="let row; columns: displayedColumns;"
        mat-row
      ></tr>
    </table>

    <mat-paginator
      (page)="paginationHandler($event)"
      [disabled]="loading"
      [length]="paginatedData?.total || 0"
      [pageSizeOptions]="[1, 10, 20, 50]"
      [pageSize]="20"
      [showFirstLastButtons]="paginatedData?.total > paginatedData?.count"
      aria-label="Select page of requests"
    >
    </mat-paginator>
  </div>
</ng-template>

<ng-template #MAINTENANCE_TABLE_MOBILE>
  <div class="mat-elevation-z2">
    <div class="table-filters">
      <mat-form-field>
        <mat-label>Search</mat-label>
        <input
          matInput
          #filterInput
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Status</mat-label>
        <select
          [(ngModel)]="maintenanceStatus"
          [ngModelOptions]="{standalone: true}"
          matNativeControl
          (ngModelChange)="filterMaintenances()"
        >
          <option
            *ngFor="let status of maintenanceStatusValues | keyvalue"
            [value]="status.value"
          >{{status.key}}</option>
        </select>
      </mat-form-field>
    </div>
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      (matSortChange)="sortHandler($event)"
    >
      <ng-container matColumnDef="request_details">
        <th
          *matHeaderCellDef
          [disabled]="loading"
          mat-header-cell
          mat-sort-header
        > Request </th>
        <td
          mat-cell
          *matCellDef="let element"
        >
          <p>{{element.created_at | humanDate}} {{element.status}}</p>
          <p>{{element.request_details}}</p>
          <div class="table-row-controls">
            <button
              (click)="showBoatDialog(element.boat)"
              mat-button
              title="Click to view boat {{element.boat?.name}}"
            >{{element.boat?.name}}</button>
            <a
              (click)="goToViewMaintenance(element)"
              mat-button
              title="Click to view this request"
            >View</a>
          </div>
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumnsMobile"
      ></tr>
      <tr
        *matRowDef="let row; columns: displayedColumnsMobile;"
        mat-row
      ></tr>
    </table>

    <mat-paginator
      (page)="paginationHandler($event)"
      [disabled]="loading"
      [length]="paginatedData?.total || 0"
      [pageSizeOptions]="[1, 10, 20, 50]"
      [pageSize]="20"
      [showFirstLastButtons]="paginatedData?.total > paginatedData?.count"
      aria-label="Select page of requests"
    >
    </mat-paginator>
  </div>
</ng-template>
